# üìñ ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î Rust Clean Architecture

## üéØ ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥

### 1Ô∏è‚É£ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: `src/lib.rs` ‡πÅ‡∏•‡∏∞ `src/main.rs`
- **`lib.rs`**: ‡∏î‡∏π‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ
- **`main.rs`**: ‡∏î‡∏π‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö dependencies

### 2Ô∏è‚É£ Domain Layer: `src/entities/`
- **`entities/items.rs`**: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö (Business Objects)
- ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö ‡πÑ‡∏°‡πà‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å

### 3Ô∏è‚É£ Infrastructure Layer: `src/repositories/`
- **`repositories/items.rs`**: Interface ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• + Mock generation
- **`repositories/staff.rs`**: Implementation ‡∏à‡∏£‡∏¥‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Staff

### 4Ô∏è‚É£ Application Layer: `src/usecases/`
- **`usecases/staff.rs`**: ‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à
- **`usecases/staff_test.rs`**: ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Mock objects

### 5Ô∏è‚É£ Interface Layer: `src/handlers/`
- **`handlers/staff.rs`**: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ HTTP requests/responses

### 6Ô∏è‚É£ Support Files: `src/models/`, `src/database.rs`, etc.
- **`models/`**: ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö API
- **`database.rs`**: ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- **`setting.rs`**: ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö

---

## üèóÔ∏è Clean Architecture Layers

```
üåê Interface Layer (handlers/)
    ‚Üì calls
üß† Application Layer (usecases/)
    ‚Üì calls
üèõÔ∏è Domain Layer (entities/)
    ‚Üë used by
üíæ Infrastructure Layer (repositories/)
```

### üìã Dependency Rules
- **‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å ‚Üí ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô**: Outer layers ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö inner layers
- **‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‚â† ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å**: Inner layers ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å outer layers
- **Inversion of Control**: ‡πÉ‡∏ä‡πâ interfaces ‡πÅ‡∏•‡∏∞ dependency injection

---

## üß© ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Structs, Traits, ‡πÅ‡∏•‡∏∞ Types

### üì¶ Structs
- **`Items`**: Entity ‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á item ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
- **`StaffRepository`**: Implementation ‡∏à‡∏£‡∏¥‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Staff
- **`StaffUsecase`**: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ business logic ‡∏Ç‡∏≠‡∏á Staff

### üîß Traits
- **`ItemsRepository`**:
  - Interface ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  - ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô implementation ‡πÑ‡∏î‡πâ (Database, Mock, File, etc.)
  - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Dependency Inversion Principle

### üìù Types
- **`SharedItemsRepository`**:
  - Type alias ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö `Arc<dyn ItemsRepository + Send + Sync>`
  - ‡πÉ‡∏ä‡πâ‡πÅ‡∏ä‡∏£‡πå Repository ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á threads ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
  - `Arc` = Atomic Reference Counting ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö shared ownership

---

## üé≠ ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Mock Objects

### ‚ùì Mock ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?
Mock ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£**‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°**‡∏Ç‡∏≠‡∏á dependencies ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### üí° ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Mock?
1. **‡πÅ‡∏¢‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö**: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Use Case ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
2. **‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå**: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ dependency ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏∞‡πÑ‡∏£
3. **‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß**: ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
4. **‡∏ó‡∏î‡∏™‡∏≠‡∏ö Error Cases**: ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢

### üõ†Ô∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

#### 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Mock Repository
```rust
let mut items_repository_mock = MockItemsRepository::new();
```

#### 2. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏° (Setup Expectations)
```rust
items_repository_mock
    .expect_find_by_name()           // ‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å
    .with(eq("wooden staff"))        // ‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ
    .times(1)                        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
    .returning(|_| Box::pin(async {  // ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ô‡∏µ‡πâ
        Err(sqlx::Error::RowNotFound)
    }));
```

#### 3. ‡πÉ‡∏ä‡πâ Mock ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö
```rust
let staff_usecase = StaffUsecase::creation(
    Arc::new(items_repository_mock), // ‡πÉ‡∏ä‡πâ Mock ‡πÅ‡∏ó‡∏ô‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á
    timer_helper
);

let result = staff_usecase.adding(req).await; // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö
```

### üîç ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ Mock Setup

#### Mock 1: `find_by_name()` ‚Üí `RowNotFound`
- **‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå**: ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Staff ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ
- **‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•**: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Use Case ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ

#### Mock 2: `insert()` ‚Üí `Ok(1)`
- **‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå**: ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡∏∞‡πÑ‡∏î‡πâ ID = 1
- **‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•**: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Use Case ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£

#### Mock 3: `find_by_id(1)` ‚Üí `Ok(Entity)`
- **‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå**: ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
- **‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•**: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÑ‡∏î‡πâ

---

## üöÄ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á

### ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô Test
```bash
cargo test
```

### ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô Application
```bash
cargo run
```
- Server ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà port ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô config
- ‡πÉ‡∏ä‡πâ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PostgreSQL ‡∏à‡∏£‡∏¥‡∏á
- Route: `POST /items/staff`

---

## üí° Tips ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î

1. **‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å `main.rs`**: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à flow ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
2. **‡∏ï‡∏≤‡∏° Dependencies**: ‡∏î‡∏π‡∏ß‡πà‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞ layer ‡πÉ‡∏ä‡πâ‡∏≠‡∏∞‡πÑ‡∏£‡∏à‡∏≤‡∏Å layer ‡∏≠‡∏∑‡πà‡∏ô
3. **‡∏î‡∏π Tests**: ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î
4. **‡∏®‡∏∂‡∏Å‡∏©‡∏≤ Traits**: ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à interfaces ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ abstraction
5. **‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° Error Handling**: ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£

---

## üîß Tools & Libraries ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ

- **axum**: Web framework ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö HTTP server
- **sqlx**: Database library ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PostgreSQL
- **tokio**: Async runtime
- **mockall**: Library ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á Mock objects
- **chrono**: Date/time handling
- **tracing**: Logging ‡πÅ‡∏•‡∏∞ observability